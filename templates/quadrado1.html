<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Autom√°tico 3x3</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quadrado1.css') }}">
</head>
<body>
<div class="container container-principal">
    <div class="magic-card bg-white p-4 shadow">
        <h1 class="titulo mb-4">Gerador Autom√°tico 3x3</h1>
        <form class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3 mb-4" onsubmit="event.preventDefault(); gerarQuadrado();">
            <div class="d-flex flex-column align-items-center">
                <label for="start" class="form-label label-pequeno mb-1 w-100 text-center">N√∫mero inicial:</label>
                <input type="number" id="start" value="1" class="form-control text-center input-inicio" style="width:100px;" min="-999" max="999">
            </div>
            <button type="submit" class="btn btn-primary btn-gerar mt-2 mt-sm-4 align-self-sm-end align-self-center">‚ú® Gerar Quadrado</button>
        </form>
        <div id="magic-result" class="d-flex flex-column align-items-center"></div>
        <div id="copy-box" class="text-center mt-2"></div>
        <a href="{{ url_for('pagina_inicial') }}" class="btn btn-outline-secondary mt-4" style="max-width:210px;">&larr; Voltar ao Menu</a>
    </div>
</div>
<script>
    function copyTexto(texto) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(texto).then(() => {
                document.getElementById('copy-box').innerHTML = "<small class='text-success'>Copiado!</small>";
            }).catch(() => {
                document.getElementById('copy-box').innerHTML = "<small class='text-danger'>N√£o foi poss√≠vel copiar automaticamente.</small>";
            });
        } else {
            document.getElementById('copy-box').innerHTML = "<small class='text-danger'>Seu navegador n√£o permite c√≥pia autom√°tica.</small>";
        }
    }

function gerarQuadrado() {
    const start = document.getElementById('start').value || 1;
    fetch('/generate', {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "start=" + encodeURIComponent(start)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            let table = `<table class="magic-table"><tbody>`;
            for (let row of data.square) {
                table += "<tr>";
                for (let v of row) table += `<td class="magic-cell">${v}</td>`;
                table += "</tr>";
            }
            table += "</tbody></table>";
            table += `<div class="magic-sum alert alert-info mt-4">Soma m√°gica: <b>${data.magic_sum}</b></div>`;
            document.getElementById("magic-result").innerHTML = table;

                const texto = data.square.map(r => r.join('\t')).join('\n');
                document.getElementById('copy-box').innerHTML = `
                    <button type="button" class="btn btn-outline-primary btn-sm mt-3 btn-copiar" onclick='copyTexto(${JSON.stringify(texto)})'>üìã Copiar como texto</button>
                    <div class="mt-1"><small class="text-muted">Formato tabulado pronto para colar</small></div>
                `;
        } else {
            document.getElementById("magic-result").innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
        }
    });
}
window.onload = gerarQuadrado;
</script>
</body>
</html>
